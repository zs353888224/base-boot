description = 'env of project'
def profile = 'local'

sourceSets {
    main {
        resources {
            srcDir("src/main/conf/" + profile)
        }
    }
    test {
        resources {
            srcDir("src/main/conf/" + profile)
        }
    }
}

task copyConf {
    doFirst {
        def p = profile
        if (project.hasProperty("env")) {
            p = "${env}"
        }
        copy {
            from('src/main/conf/' + p)
            into('build/resources/test')
        }
    }
}

gradle.projectsEvaluated {
    classes.dependsOn(copyConf)
}